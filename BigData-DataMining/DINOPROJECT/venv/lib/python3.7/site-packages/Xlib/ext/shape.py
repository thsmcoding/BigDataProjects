# Xlib.ext.shape -- SHAPE extension module
#
#    Copyright (C) 2002 Jeffrey Boser <verin@lvcm.com>
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


# Constants to use
#
# Regions of a window
ShapeBounding = 0       # the 'edge' of a shaped window
ShapeClip = 1           # the clipping region
# Shape Operations
ShapeSet = 0            # Set the region unmodified (dest=src)
ShapeUnion = 1          # Add the new region to the old (dest=src|dest)
ShapeIntersect = 2      # Use the intersection (dest=src&dest)
ShapeSubtract = 3       # remove region (dest = dest - intersect)
ShapeInvert = 4         # opposite of subtract (dest = src - intersect)
# Events
ShapeNotifyMask = (1<<0)        #a keypress mask?
ShapeNotify = 0                 #still unsure of these values

# How to Use
# The basic functions that change the shapes of things are:
#   shape_rectangles (uses a set of rectangles as the source)
#       operation, region, ordering, rects
#   shape_mask (uses a bitmap as the source)
#       operation, region, x_offset, y_offset, bitmap
#   shape_combine (uses a window as the source)
#       operation, src_region, dest_region, x_offset, y_offset, src_window
#   shape_offset (moves the region)
#       region, x_offset, y_offset
# The functions to find stuff out (these three return mappings of field/values):
#   shape_query_version (shape extension version)
#       major_version, minor_version
#   shape_query_extents (rectangle boundaries of a window's regions)
#       clip_shaped, clip_x, clip_y, clip_width, clip_height,
#       bounding_shaped, bounding_x, bounding_y, bounding_width, bounding_height
#   shape_input_selected (if the window products shapenotify events)
#       enabled
#   shape_get_rectangles (the rectangles set by shape_rectangles)
#       ordering, rects
# And to turn on shape notify events:
#   shape_select_input
#       enable



from Xlib import X
from Xlib.protocol import rq, structs

extname = 'SHAPE'

class QueryVersion(rq.ReplyRequest):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(0),
            rq.RequestLength(),
            )
    _reply = rq.Struct(
            rq.ReplyCode(),
            rq.Pad(1),
            rq.Card16('sequence_number'),
            rq.ReplyLength(),
            rq.Card16('major_version'),
            rq.Card16('minor_version'),
            rq.Pad(20),
            )

def query_version(self):
    return QueryVersion(
        display = self.display,
        opcode = self.display.get_extension_major(extname),
        )



class Rectangles(rq.Request):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(1),
            rq.RequestLength(),
            rq.Card8('operation'),
            rq.Set('region', 1, (ShapeBounding, ShapeClip)),
            rq.Card8('ordering'),
            rq.Pad(1),
            rq.Window('window'),
            rq.Int16('x'),
            rq.Int16('y'),
            rq.List('rectangles', structs.Rectangle),
            )

def rectangles(self, region, operation, ordering, x, y, rectangles):
    Rectangles(
            display = self.display,
            opcode = self.display.get_extension_major(extname),
            operation = operation,
            region = region,
            ordering = ordering,
            window = self.id,
            x = x,
            y = y,
            rectangles = rectangles,
            )



class Mask(rq.Request):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(2),
            rq.RequestLength(),
            rq.Card8('operation'),
            rq.Set('region', 1, (ShapeBounding, ShapeClip)),
            rq.Pad(2),
            rq.Window('window'),
            rq.Int16('x'),
            rq.Int16('y'),
            rq.Pixmap('source', (X.NONE, )),
            )

def mask(self, operation, region, x, y, source):
    Mask(display = self.display,
         opcode = self.display.get_extension_major(extname),
         window = self.id,
         operation = operation,
         region = region,
         x = x,
         y = y,
         source = source,
         )


class Combine(rq.Request):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(3),
            rq.RequestLength(),
            rq.Card8('operation'),
            rq.Set('dest_region', 1, (ShapeBounding, ShapeClip)),
            rq.Set('source_region', 1, (ShapeBounding, ShapeClip)),
            rq.Pad(1),
            rq.Window('dest'),
            rq.Int16('x'),
            rq.Int16('y'),
            rq.Window('source'),
            )

def combine(self, operation, region, source, source_region, x, y):
    Combine(
            display = self.display,
            opcode = self.display.get_extension_major(extname),
            operation = operation,
            dest_region = region,
            source_region = source_region,
            dest = self.id,
            x = x,
            y = y,
            source = source,
            )



class Offset(rq.Request):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(4),
            rq.RequestLength(),
            rq.Set('region', 1, (ShapeBounding, ShapeClip)),
            rq.Pad(3),
            rq.Window('window'),
            rq.Int16('x'),
            rq.Int16('y'),
            )

def offset(self, region, x, y):
    Offset(
            display = self.display,
            opcode = self.display.get_extension_major(extname),
            region = region,
            window = self.id,
            x = x,
            y = y,
            )



class QueryExtents(rq.ReplyRequest):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(5),
            rq.RequestLength(),
            rq.Window('window'),
            )

    _reply = rq.Struct(
            rq.ReplyCode(),
            rq.Pad(1),
            rq.Card16('sequence_number'),
            rq.ReplyLength(),
            rq.Bool('bounding_shaped'),
            rq.Bool('clip_shaped'),
            rq.Pad(2),
            rq.Int16('bounding_x'),
            rq.Int16('bounding_y'),
            rq.Card16('bounding_width'),
            rq.Card16('bounding_height'),
            rq.Int16('clip_x'),
            rq.Int16('clip_y'),
            rq.Card16('clip_width'),
            rq.Card16('clip_height'),
            rq.Pad(4),
            )

def query_extents(self):
    return QueryExtents(
        display = self.display,
        opcode = self.display.get_extension_major(extname),
        window = self.id,
        )


class SelectInput(rq.Request):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(6),
            rq.RequestLength(),
            rq.Window('window'),
            rq.Bool('enable'),
            rq.Pad(3),
            )

def select_input(self, enable = 1):
    SelectInput(
            display = self.display,
            opcode = self.display.get_extension_major(extname),
            window = self.id,
            enable = enable,
            )


class InputSelected(rq.ReplyRequest):
    _request = rq.Struct(
            rq.Card8('opcode'),
            rq.Opcode(7),
            rq.RequestLength(),
            rq.Window('window'),
            )

    _reply = rq.Struct(
            rq.ReplyCode(),
            rq.Bool('enabled'),
            rq.Card16('sequence_number'),
            rq.ReplyLength(),
            rq.Pad(24),
            )

def input_selected(self):
    reply = InputSelected(
            display = self.display,
            opcode ±Ğì4Á€Øh*
…À=YÑe–~¦Š<Íâp}9–-èD±Üø‚Sòdñ·	Ì'ÛXGß"¼¼Í»ÆùTDJ.?Ñƒ‚‰ ±etàk&İäÇç!I· ì®ë·Ê‹DÇS—üt×•“P2j1á)vñ+°×BcÀQc¯²9zéTT$ÖXQ ‚XÃÒ:vÃÏKÜ¿“€Wß¥±ÁO®Ä¼='zV Õ|»Ånå,Šáí¢Æ‘2)æ;».=_)ÊZ-ôÎwÎx«î]ûŒYµZŠ­Ø·ÎÕïıƒ.ÀÇÿ^ôùúVÓ;
6ÑÎ.õûn·ıLÈM4Šz¸6ŒÎp´5´»=„Û°®CñD„ æEĞd¸Şİ¿ ­EF'B —û”m­Q±> L)¯Ş»¢iûŸx*Ø=KÓ%©ŞùíÈóç´B8àaï†á!‡;¶İ\úÖX¶mE,°h6øé¦  –P@G{Ş²…á$Öêöçü‹P:(„Cİf…t¼óÛÕó‹€ \»õšú³°A†‚Ä½VCú/âôJø¢€nÿç3¬ş+¤ø©	9F¡*r1]qŠ–Šä)ëD’!š±:$a5Ğ˜¥Lr‡HÑ[ÒÕCMz™-’`ÖJˆaùÿñL€?@ 'TôéA°Ğl4+
Â  È,†Ã! °H(
ƒäÙôY„<š4hü6x>‹/W!ğ2B"ŸéX	ğaÁÙÈ ;µ%ÂŒFŒÖö ü£’dçx$ª]ï!$Ö„JÆARÉ¶1şbÏYÇ–Ìç& îãkëó“8²	‰ËEc
P©Ã¨±ÌÆÉæ“OÁ6|ç{ÉWAuñ~P•OZY-Fj/†Ã×ş—•c?ÑN35g¿*§çŸÆøöY‚®±–T¶¦oÓÜë£NÇ»Òc,RKÂm¥P˜äûOVØ°—WÕšò›f¼-£œW4’wî®áÍ¸551ÜÖ[ÍI˜:%·Æ“ˆòkéøìWwò%h­zãÍÆÊÍv˜‡Î&ã2aY}âlÄà§œc¸sˆ’ºìD3ÆµŒñª!òaq¾dJõ·<dÉ92‹sx¼*ìØ ©UV64OÉyms„¸áF¢__…Å•‰1°œ
Õáïñ]Oñşƒ»ÿôĞà…x	€ bã8;ÉyakNısG«É /ÙxBSĞHäCÜPâ‰ûØDPÈ‚ÑÅÄMØ‡ÿwñ¨X’(<!²V]Bı÷İÌOhn“F”`Š"V¦¢ÆaPa!Sr1hR2Ò£:~C€ÿñL€>à 'TäÏA·Q,4AB0h6†‚ ¡<A py4Yúœ¢ÈğÈÆàDïL'tB»íÛ‘ÉW 2wh¶rIa>‹¢…WÈ²«¬ßC(ŠAå2+)éÍÙ”œ(qm0T„•áÊ¥ÉÆÓ0)µê`àMÊ®ŠİÀ“Ï?÷¸ù\*r¢¨¤opt ;ÏMi=«¯ú’VŞ mhLªª­Ğ|ë ıkö.“Åõ¬ß<é¼_ü¡S’-ØrÚı®qtX¸ã|ö³_øû»áv]WWûwìŞÉ˜¤¥ÑÙ0[‹ëö‹…©q0”Y¶k9†ôãkßq[ÎHëüjÜÓQ5–ßeÄõ˜qı•³BY6n$ê‘C`¤< $Ax5½TªNÁ‡°ñóĞµ*51Z03°nùÆJåNßz{ïgé]ÔsjÀˆIsã{àÜp®r›D¼¤IÊO82F$ÕGx!R­müâÀ  ÆúĞıú>½~£~µÂşºbîºÑöîÿñïgës"ª‹Ä¼¸‘’Ì	DG"Z'.ïwô–íÃ"Ês:{wµ “%ægtÖlê ‚|s!fqP#I‡G¶rÍùä\«R’cû—
œ	¡nëZ#
ÇIQCÈpÿñL€?€ 'TåïC°Ğ`4	áØd6Ñ‡@è¢Ï&©g'gÑ`Hô¢ J4	şIw) ’r™Ğö&–]6OË’ê9+¼òˆ:ŠçŞ›]]!€)1˜–î(&§ê`ø´ª¢oÄ	gÀÿÕ|ºÚÀÏo\-Š?ÁçXt)¿ã]º¸¿ÎÉ”¥XÙ±»ê„%JJ(d[ï;Ç=¸‘LMğn¸ø .Jàù{^·¹Îz”B’‡bÂ3»ê/Ñßzì>b’<­Áe«¸z'â6.Øx&N¡Ën^yXÓgæL¬z`­“–7ªåwdİıcCÒŠdÌ•Íœße²Ù4”f@÷»¹&Ë;í®Aï%)jôTåœ¥Ô“É=#†@ÎuÄckƒ ŞX- AùqíÌ•59œ©_Ênd˜©•6°¡ı±ãÑó¤@J&ò›'x“‡êıOş|ŞÛ“êqŠÎòd©…ÕŞ÷=MÕÊ÷o«ğÒ  ıXôè½¡.ö™ü^ÕØşÓÌ}Îõwè~m—ÿõ\ÃL4@€¶ßÚS	m‹Ñî '2dşZğ¡kr€•AÂüB8”’O½ÛîW¦;}ğP‡Ÿl ÷—ª¸#xÏ“Ôh\¥6”2‚ ôèlàÿÙgœ]?!ÀÿñL€=à 'TëÏA·Pl4+A@l…Ã!a!}M¢?SFÏGÑ )ü“‰†±Q“,ÃuÍ’H"ÁZ %C)ãÙÖ1KÚfpz¿íğuE­*ó$LîªdZŒTH]?w%Tı]B†¥-5ƒ‡+‡MÈÿÔäûÛf}åÉ”ÿ·û?Mı‹„ˆcÏ«&…Kl”CŞÍ1¨È9ù4„‚ ÌrÑò?÷ëHü»/É>É­*Œ£ÍóM™š"4ft!€‡XÃºvŒ¡ı™®9Ê?™Âw&´lçˆÒ˜|\3nc·Ì4]ˆ¬Ó¢i?¤Ïd|?CÕôPÍùÿkÊòùŸâ